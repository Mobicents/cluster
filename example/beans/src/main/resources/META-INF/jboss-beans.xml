<?xml version="1.0" encoding="UTF-8"?>

<deployment xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:jboss:bean-deployer:2.0">

	<!-- cluster control -->
	
	<bean name="Mobicents.Cluster.DataSource" class="org.mobicents.cluster.infinispan.InfinispanClusterDataSource" />
	
	<bean name="Mobicents.Cluster" class="org.mobicents.cluster.infinispan.InfinispanCluster">
		<constructor>
			<parameter><inject bean="Mobicents.Cluster.DataSource"/></parameter>
			<parameter><inject bean="RealTransactionManager"/></parameter>
		</constructor>				
	</bean>
	
	<bean name="Mobicents.FaultTolerantJavaUtilTimer" class="org.mobicents.timers.timer.FaultTolerantTimer">
		<constructor>
			<parameter>timer</parameter>
			<parameter><inject bean="Mobicents.Cluster"/></parameter>
			<!-- cluster local listener priority -->
			<parameter>10</parameter>
			<parameter><inject bean="RealTransactionManager"/></parameter>
		</constructor>		
	</bean>
	
	<bean name="MCClusterTest" class="org.mobicents.cluster.test.MCClusterTest">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="org.mobicents:name=FaultTolerantTimerServiceExample",exposedInterface=org.mobicents.cluster.test.MCClusterTestMBean.class,registerDirectly=true)
		</annotation>

		<property name="faultTolerantTimer">
			<inject bean="Mobicents.FaultTolerantJavaUtilTimer" />
		</property>
		<property name="jta">
			<inject bean="RealTransactionManager" />
		</property>		
	</bean>

</deployment>